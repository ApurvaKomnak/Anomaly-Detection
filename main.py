import numpy as np 
from scipy.stats import multivariate_normal
def multivariateGaussian(dataset,mu,sigma):
    p = multivariate_normal(mean=mu, cov=sigma)
    return p.pdf(dataset)
def detect_anomaly(sample_array,mu_sample,sigma_sample,epsilon):
    p_sample = multivariateGaussian(sample_array,mu_sample,sigma_sample)
    # if len(sample_array)>1:
    #     flags=[]
    #     for p_value in p_sample:
    #         if p_value>epsilon:
    #             flags.append("False")
    #         else:
    #             flags.append("True")
    #     return flags
    # else:
    if p_sample>epsilon:
        return {str(p_sample):'False'}
    else:
        return {str(p_sample):'True'}


#driver code

# mu_sample = [0.5104878976927436, 0.10726751237075804, -0.06597896894433525, 0.02486667500272543, -0.015892024287892277, 0.1839426400556174, -0.08242157559256776, 0.09760795968403549, 0.0027448909460531974, 0.05924062888782901, -0.044862776009553566]

# sigma_sample = np.array([[1.6315738595225007, 0.02969780578179036, 0.021125582785734003, -0.038732782253550584, -0.06320081454552562, -0.003341050761664314, 0.010500847663729124, -0.1394434810871321, -0.1439256060849544, -0.10751277622375148, -0.09204016605238273], [0.02969780578179036, 1.8194451167891945, 0.04289876830413793, 0.04169494936059093, 0.004416334834498522, -0.04906035712769383, 0.08011453349925772, 0.07671042037386683, -0.010551868628870082, 0.11439587400101368, 0.010351799146148038], [0.021125582785734003, 0.04289876830413793, 1.2321844295883917, -0.004619618699988002, -0.05318813789415452, 0.06513034693933856, -0.0857846429339284, -0.08472615233556996, -0.045377677780911535, -0.13468234383277583, -0.029481190926730756], [-0.038732782253550584, 0.04169494936059093, -0.004619618699988002, 1.297192977256955, -0.06989936822782654, 0.04053402086336947, -0.2158161052895833, 0.050017140126056306, -0.0824062645891581, 0.00828991143014992, -0.011272182777290562], [-0.06320081454552562, 0.004416334834498522, -0.05318813789415452, -0.06989936822782654, 1.055313219049395, 0.06808551309192701, -0.06747297470993807, -0.16401160953310331, -0.03403469733960567, -0.07775285256894751, -0.023020089209377426], [-0.003341050761664314, -0.04906035712769383, 0.06513034693933856, 0.04053402086336947, 0.06808551309192701, 1.0464978278447712, 0.010209219634374144, 0.11145650672707165, 0.025291951382257507, 0.06381415071071707, 0.018736612358449957], [0.010500847663729124, 0.08011453349925772, -0.0857846429339284, -0.2158161052895833, -0.06747297470993807, 0.010209219634374144, 1.1510171550376098, -0.22813881863308488, -0.0853004994670815, -0.13028856956897936, -0.08342080527789428], [-0.1394434810871321, 0.07671042037386683, -0.08472615233556996, 0.050017140126056306, -0.16401160953310331, 0.11145650672707165, -0.22813881863308488, 0.8036591150082855, 0.0048592012906042, -0.0328031741682117, 0.024697810090848458], [-0.1439256060849544, -0.010551868628870082, -0.045377677780911535, -0.0824062645891581, -0.03403469733960567, 0.025291951382257507, -0.0853004994670815, 0.0048592012906042, 0.6958894548726956, -0.11473801398984484, -0.013669447250403165], [-0.10751277622375148, 0.11439587400101368, -0.13468234383277583, 0.00828991143014992, -0.07775285256894751, 0.06381415071071707, -0.13028856956897936, -0.0328031741682117, -0.11473801398984484, 0.5806967765978739, -0.07770198614173679], [-0.09204016605238273, 0.010351799146148038, -0.029481190926730756, -0.011272182777290562, -0.023020089209377426, 0.018736612358449957, -0.08342080527789428, 0.024697810090848458, -0.013669447250403165, -0.07770198614173679, 0.6627760747761463]])

# ep = 1.0527717316e-70

# sample_array = np.array([[-4.32534151249494,
#   -1.7372054992609,
#   -2.98065040276283,
#   2.10426904264972,
#   1.84638841257164,
#   -0.924967539453603,
#   1.03674367779061,
#   0.299185110890814,
#   1.82337037774654,
#   0.977859323115455,
#   1.45471158817804]])

# flags = detect_anomaly(sample_array,mu_sample,sigma_sample,ep)
# print(flags)